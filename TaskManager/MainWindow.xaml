<Window x:Class="TaskManager.Client.Views.MainWindow"
        xmlns:converters="clr-namespace:TaskManager.Client.Converters"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewModels="clr-namespace:TaskManager.Client.ViewModels"
        xmlns:models="clr-namespace:TaskManager.Client.Models"
        mc:Ignorable="d"
        Title="Task Manager" Height="600" Width="1280">

    <Window.DataContext>
        <viewModels:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <converters:BoolToBrushConverter x:Key="BoolToBrushConverter" />
        <converters:IntToBoolConverter x:Key="IntToBoolConverter" />
        <converters:IntToVisibilityConverter x:Key="IntToVisibilityConverter" />
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Toolbar -->
            <RowDefinition Height="*"/>
            <!-- Task List -->
            <RowDefinition Height="Auto"/>
            <!-- Quote -->
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <StackPanel Orientation="Horizontal" Margin="0 0 0 10" Grid.Row="0" VerticalAlignment="Center" >
            <TextBox Width="250" Margin="0 0 10 0" 
                     Text="{Binding NewTaskTitle, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="Add Task" Command="{Binding AddTaskCommand}" Margin="0 0 10 0"/>
            <Button Content="Load Tasks" Command="{Binding LoadTasksCommand}" Margin="0 0 10 0"/>

            <Separator Width="10"/>

            <Button Content="Export JSON" Width="100" Margin="0 0 5 0"
                    Command="{Binding ExportToJsonCommand}"
                    IsEnabled="{Binding Tasks.Count, Converter={StaticResource IntToBoolConverter}}"/>
            <Button Content="Export XML" Width="100" Margin="0 0 5 0"
                    Command="{Binding ExportToXmlCommand}"
                    IsEnabled="{Binding Tasks.Count, Converter={StaticResource IntToBoolConverter}}"/>
            <Button Content="Export PDF" Width="100"
                    Command="{Binding ExportToPdfCommand}"
                    IsEnabled="{Binding Tasks.Count, Converter={StaticResource IntToBoolConverter}}"/>

            <Separator Width="10"/>

            <ComboBox Width="120" Margin="0 0 5 0"
                      SelectedValue="{Binding StatusFilter, Mode=TwoWay}"
                      SelectedValuePath="Content">
                <ComboBoxItem Content="All"/>
                <ComboBoxItem Content="Completed"/>
                <ComboBoxItem Content="Pending"/>
            </ComboBox>

            <ComboBox Width="120"
                      SelectedValue="{Binding SortOption, Mode=TwoWay}"
                      SelectedValuePath="Content">
                <ComboBoxItem Content="None"/>
                <ComboBoxItem Content="Title"/>
                <ComboBoxItem Content="Id"/>
            </ComboBox>
        </StackPanel>

        <!-- Task List -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <ListBox ItemsSource="{Binding FilteredTasks}"
                     SelectedItem="{Binding SelectedTask}"
                     Margin="0 0 0 10">
                <ListBox.ItemTemplate>
                    <DataTemplate DataType="{x:Type models:TaskItem}">
                        <Border Margin="0 2" Padding="5" CornerRadius="5"
                                Background="{Binding IsCompleted, Converter={StaticResource BoolToBrushConverter}}">
                            <DockPanel>
                                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                                    <Button Content="✔" Width="30" Margin="0 0 5 0"
                                            Command="{Binding DataContext.ToggleTaskCompletedCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                            CommandParameter="{Binding}"/>
                                    <Button Content="🗑" Width="30"
                                            Command="{Binding DataContext.DeleteTaskCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                            CommandParameter="{Binding}"/>
                                </StackPanel>
                                <TextBlock Text="{Binding Title}" FontSize="16" VerticalAlignment="Center" Margin="10 0 0 0"/>
                            </DockPanel>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </ScrollViewer>

        <!-- Motivational Quote -->
        <TextBlock Grid.Row="2" Text="{Binding MotivationalQuote}" 
                   TextWrapping="Wrap" 
                   FontStyle="Italic"
                   Margin="0 10 0 0"
                   Foreground="Gray"/>
    </Grid>
</Window>
