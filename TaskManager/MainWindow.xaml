<Window x:Class="TaskManager.Client.Views.MainWindow"
        xmlns:converters="clr-namespace:TaskManager.Client.Converters"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TaskManager.Client.Views"
        xmlns:viewModels="clr-namespace:TaskManager.Client.ViewModels"
        xmlns:models="clr-namespace:TaskManager.Client.Models"
        mc:Ignorable="d"
        Title="Task Manager" Height="600" Width="1280">
    <Window.DataContext>
        <viewModels:MainViewModel/>
    </Window.DataContext>
    <Window.Resources>
        <converters:BoolToBrushConverter x:Key="BoolToBrushConverter" />
        <converters:IntToBoolConverter x:Key="IntToBoolConverter" />
        <converters:IntToVisibilityConverter x:Key="IntToVisibilityConverter" />

    </Window.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Controls -->
        <StackPanel Orientation="Horizontal" Margin="0 0 0 10">
            <TextBox Width="300" Margin="0 0 10 0" Text="{Binding NewTaskTitle, UpdateSourceTrigger=PropertyChanged}"/>
            <Button Content="Add Task" Command="{Binding AddTaskCommand}"/>
            <Button Content="Load Tasks" Command="{Binding LoadTasksCommand}" Margin="10 0 0 0"/>
            <Button Content="Export to JSON"
            Margin="5"
            Width="120"
            Command="{Binding ExportToJsonCommand}"
            IsEnabled="{Binding Tasks.Count, Converter={StaticResource IntToBoolConverter}}" />

            <Button Content="Export to XML"
            Margin="5"
            Width="120"
            Command="{Binding ExportToXmlCommand}"
            IsEnabled="{Binding Tasks.Count, Converter={StaticResource IntToBoolConverter}}" />

            <Button Content="Export to PDF"
            Margin="5"
            Width="120"
            Command="{Binding ExportToPdfCommand}"
            IsEnabled="{Binding Tasks.Count, Converter={StaticResource IntToBoolConverter}}" />
            <ComboBox Width="120"
          SelectedValue="{Binding StatusFilter, Mode=TwoWay}"
          SelectedValuePath="Content"
          Margin="0,0,10,0">
                <ComboBoxItem Content="All"/>
                <ComboBoxItem Content="Completed"/>
                <ComboBoxItem Content="Pending"/>
            </ComboBox>

            <ComboBox Width="120"
          SelectedValue="{Binding SortOption, Mode=TwoWay}"
          SelectedValuePath="Content">
                <ComboBoxItem Content="None"/>
                <ComboBoxItem Content="Title"/>
                <ComboBoxItem Content="Id"/>
            </ComboBox>
        </StackPanel>

        <!-- Task List -->
        <ListBox Grid.Row="1" ItemsSource= "{Binding FilteredTasks}" SelectedItem="{Binding SelectedTask}" Margin="0 10 0 0">
            <ListBox.ItemTemplate>
                <DataTemplate DataType="{x:Type models:TaskItem}">
                    <Border Margin="0 2" Padding="5" CornerRadius="5"
                            Background="{Binding IsCompleted, Converter={StaticResource BoolToBrushConverter}}">
                        <DockPanel>
                            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                                
                                <Button Content="✔" Width="30" Margin="0 0 5 0"
                                        Command="{Binding DataContext.ToggleTaskCompletedCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                        CommandParameter="{Binding}"/>
                                <Button Content="🗑" Width="30"
                                        Command="{Binding DataContext.DeleteTaskCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                        CommandParameter="{Binding}"/>
                            </StackPanel>
                            <TextBlock Text="{Binding Title}" FontSize="16" VerticalAlignment="Center" Margin="10 0 0 0"/>
                        </DockPanel>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </Grid>
</Window>
